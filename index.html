<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rooster Crow Counter (Simple)</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 40px; }
    h1 { color: #222; }
    #count { font-size: 2em; color: green; }
    .settings { margin-top: 20px; padding: 10px; border: 1px solid #ccc; display: inline-block; text-align: left; }
    label { display: block; margin-top: 8px; }
  </style>
</head>
<body>
  <h1>üêì Rooster Crow Counter</h1>
  <button id="startBtn">üé§ Start Listening</button>
  <p id="status">Idle...</p>
  <p>Crow Count: <span id="count">0</span></p>

  <div class="settings">
    <h3>‚öôÔ∏è Settings</h3>
    <label>Volume Threshold: <span id="threshVal">50</span>
      <input type="range" id="threshold" min="10" max="100" value="50">
    </label>
    <label>Cooldown (ms): <span id="coolVal">2000</span>
      <input type="range" id="cooldown" min="500" max="5000" step="100" value="2000">
    </label>
    <button id="resetBtn">Reset Count</button>
  </div>

  <script>
    let count = 0;
    let listening = false;
    let lastTime = 0;
    let threshold = 50;
    let cooldown = 2000;

    const statusEl = document.getElementById('status');
    const countEl = document.getElementById('count');
    const threshEl = document.getElementById('threshold');
    const coolEl = document.getElementById('cooldown');

    threshEl.addEventListener('input', () => {
      threshold = parseInt(threshEl.value);
      document.getElementById('threshVal').innerText = threshold;
    });

    coolEl.addEventListener('input', () => {
      cooldown = parseInt(coolEl.value);
      document.getElementById('coolVal').innerText = cooldown;
    });

    document.getElementById('resetBtn').onclick = () => {
      count = 0;
      countEl.innerText = count;
    };

    document.getElementById('startBtn').onclick = async () => {
      if (listening) return;
      listening = true;
      statusEl.innerText = "Listening...";

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioCtx.createMediaStreamSource(stream);
        const analyser = audioCtx.createAnalyser();
        const dataArray = new Uint8Array(analyser.fftSize);

        source.connect(analyser);

        function check() {
          analyser.getByteTimeDomainData(dataArray);
          let sum = 0;
          for (let i = 0; i < dataArray.length; i++) {
            let v = (dataArray[i] - 128) / 128;
            sum += v * v;
          }
          let rms = Math.sqrt(sum / dataArray.length) * 100;
          let now = Date.now();
          if (rms > threshold && (now - lastTime) > cooldown) {
            count++;
            countEl.innerText = count;
            lastTime = now;
          }
          requestAnimationFrame(check);
        }
        check();
      } catch (err) {
        statusEl.innerText = "Microphone error: " + err;
      }
    };
  </script>
</body>
</html>
